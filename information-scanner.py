import os.path
import argparse
import subprocess
import time
import tqdm


parser = argparse.ArgumentParser(prog='Information Scanner', 
                                usage='python firebase-scan.py apk-file', 
                                epilog='Example: python firebase-scan.py example.apk', 
                                description='A pen-testing tool to automatically finding attack surface')

parser.add_argument('apkfile', metavar='apk-file', help='name of the apk file')



def isExist(filename):
    return os.path.exists(filename)

def decodeAPK(filename):
    cmd = subprocess.Popen(['apktool', 'd','-f', filename], stdout=subprocess.PIPE,shell=True)
    pbar = tqdm.tqdm(range (100), desc=" [-] Analyzing APK", ncols=80)
    for i in pbar:
        time.sleep(0.01)
        if (i == 50):
            while (cmd.stdout.readline().decode("utf-8")):
                time.sleep(0.01)
        if (i == 99):
            pbar.set_description(" [+] Analyzing APK")

def scanInfor():
    print(1)
    


def main():
    args = parser.parse_args()
    apkfile = args.apkfile
    print("APK file: " + apkfile)

    # check file decoded
    if isExist(apkfile[:-4]):
        a = input("This file has been decoded, decode  again? (Y/n)  ")
        if (a == 'Y' or a == 'y' or a == ''):
            decodeAPK(apkfile)
    else:
        decodeAPK(apkfile)
    
    print("\nScanning Information:")
    scanInfor()

if __name__ == "__main__":
    main()